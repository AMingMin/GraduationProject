<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../Static/js/layui/css/layui.css"  media="all">
</head>
<body>
<!--面包屑-->
<div style="padding: 10px 0 0 10px;" class="layui-breadcrumb">
    <a href="javascript:void(1);">系统设置</a>
    <a href="javascript:void(1);"><cite>添加服务</cite></a>
</div>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>添加服务类型</legend>
</fieldset>

<form class="layui-form" action="  ">
    <div class="layui-form-item">
        <label class="layui-form-label">名称:</label>
        <div class="layui-input-block">
            <input type="text" name="name" style="width:200px; height:40px;" lay-verify="required" lay-reqtext="服务名称不可为空！" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">性别：</label>
        <div class="layui-input-block">
            <input type="radio" name="sex" value="男" title="男" checked="">
            <input type="radio" name="sex" value="女" title="女">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">价格:</label>
            <div class="layui-input-inline">
                <input type="text" name="price" lay-reqtext="价格不可为空！" lay-verify="required|number" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" >头发长度：</label>
        <div class="layui-input-block" style="width:200px; height:40px;">
            <select name='hair_height' lay-verify="required" lay-reqtext="头发长度不可为空！">
                <option value="">请选择头发长度</option>
                <option value="0">通用</option>
                <option value="1">超短发</option>
                <option value="2">短发</option>
                <option value="3">中短发</option>
                <option value="4">中长发</option>
                <option value="5">长发</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" >服务类型：</label>
        <div class="layui-input-block" style="width:200px; height:40px;">
            <select class="layui-form" name='service_type' lay-filter="service-type" lay-verify="required" lay-reqtext="服务类型不可为空！">
                <option value="0">洗发</option>
                <option value="1">剪发</option>
                <option value="2">烫发</option>
                <option value="3">染发</option>
                <option value="4">拉直</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item haircut_type" style="display: none;">
        <label class="layui-form-label" >剪发类型：</label>
        <div class="layui-input-block" style="width:200px; height:40px;">
            <select name='haircut_type' id="haircut_type">
                <option value="0">通用</option>
                <option value="1">板寸</option>
                <option value="2">背头</option>
                <option value="3">平头</option>
                <option value="4">圆寸</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item perm_type" style="display: none;" >
        <label class="layui-form-label" >烫发类型：</label>
        <div class="layui-input-block" style="width:200px; height:40px;">
            <select name='perm_type'id="perm_type">
                <option value="0">通用</option>
                <option value="1">编织烫</option>
                <option value="2">螺旋烫</option>
                <option value="3">离子烫</option>
                <option value="4">空气烫</option>
                <option value="5">物理烫</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item dye_hair_type" style="display: none;" >
        <label class="layui-form-label" >染发色系：</label>
        <div class="layui-input-block" style="width:200px; height:40px;">
            <select name='dye_hair_type'id='dye_hair_type'>
                <option value="0">黑色</option>
                <option value="1">奶奶灰</option>
                <option value="2">紫色</option>
                <option value="3">黄色</option>
                <option value="4">其它配色</option>
            </select>
        </div>
    </div>

    <!--************这里是上传图片的代码***************-->
    <!--************这里添加的隐藏的输入框，用来传递images的参数***************-->
    <input type="hidden" name="images" class="image">
    <div class="layui-form-item">
        <label class="layui-form-label ">照片:</label>
        <div class="layui-upload">
            <button type="button" class="layui-btn" id="test1">
                <i class="layui-icon">&#xe67c;</i>上传图片
            </button>
            <div class="layui-upload-list">
                <img class="layui-upload-img" id="demo1">
                <p id="demoText"></p>
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">简介:</label>
        <div class="layui-input-block">
            <textarea placeholder="请输入简单介绍" name="introduction" style="width:200px;"class="layui-textarea"></textarea>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit_btn">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>

</form>

<script src="../../Static/js/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
  layui.use(['form','element','upload'], function(){
    var $ = layui.$;
    var upload = layui.upload;  //上传图片
    var form = layui.form;
    var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

    //监听'提交'按钮
    form.on('submit(submit_btn)', function(data){
      // console.log(data);
      // console.log(data.field); //当前容器的全部表单字段，名值对形式：{name: value}
      var addData=data.field;  //表单字段
      $.ajax({
        type: "POST",
        url: "http://0.0.0.0:9501/ServiceType/index",
        data: {
          name: addData.name,
          sex: addData.sex,
          price: addData.price,
          service_type: addData.service_type,
          hair_height: addData.hair_height,
          haircut_type: addData.haircut_type,
          perm_type: addData.perm_type,
          dye_hair_type: addData.dye_hair_type,
          introduction: addData.introduction,
        },
        success: function (result) {  //添加成功
          layer.closeAll();  //关闭窗口
          layer.msg(result.msg, {icon: 1}, function () {});
          $('#add-member')[0].reset();
          //table.reload('tableId'); //只重载数据
        },
        error: function (result) {  //失败
          console.log(result);
          //layer.msg(result.responseJSON.msg, {icon: 5});
        },
      });

      return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
    });

    //监听'服务类型'下拉框，实现二级联动
    form.on('select(service-type)', function(data){
      switch (Number(data.value)) {
        case 1:
          $('.haircut_type').show();
          $('.perm_type').hide();
          $('.dye_hair_type').hide();
          break;
        case 2:
          $('.perm_type').show();
          $('.haircut_type').hide();
          $('.dye_hair_type').hide();
          break;
        case 3:
          $('.dye_hair_type').show();
          $('.haircut_type').hide();
          $('.perm_type').hide();
          break;
        default:
          $('.haircut_type').hide();
          $('.perm_type').hide();
          $('.dye_hair_type').hide();
      }
      form.render();
    });

    //"图片"上传
    var uploadInst = upload.render({
      elem: '#test1'
      ,url: "http://0.0.0.0:9501/ServiceType/index"
      ,accept:'images'
      ,size:50000
      ,before: function(obj){
        obj.preview(function(index, file, result){
          console.log(file);
          $('#demo1').attr('src', result);
        });
      }
      ,done: function(res){
        //如果上传失败
        if(res.code > 0){
          return layer.msg('上传失败');
        }
        //上传成功
        var demoText = $('#demoText');
        demoText.html('<span style="color: #4cae4c;">上传成功</span>');

        var fileupload = $(".image");
        fileupload.attr("value",res.data.src);
        console.log(fileupload.attr("value"));
      }
      ,error: function(){
        //演示失败状态，并实现重传
        var demoText = $('#demoText');
        demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
        demoText.find('.demo-reload').on('click', function(){
          uploadInst.upload();
        });
      }
    });

  });
</script>

</body>
</html>
